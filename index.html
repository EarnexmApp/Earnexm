<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarnEXM Pro - InisTa Edition</title>
    <style>
        :root { --y: #ffcc00; --g: #28a745; --p: #ff4d94; --bg: #000c24; --card: #1e2329; }
        body { margin: 0; background: radial-gradient(circle, #002d7a, #000c24); color: white; font-family: 'Arial Black', sans-serif; text-align: center; height: 100vh; overflow: hidden; }

        /* Balance Bar */
        .balance-header { display: flex; width: 95%; margin: 10px auto; border-radius: 12px; overflow: hidden; height: 50px; font-weight: 900; border: 2px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .exm-part { background: var(--y); color: black; flex: 1; line-height: 50px; font-size: 1.1rem; }
        .usdt-part { background: var(--g); color: black; flex: 1; line-height: 50px; font-size: 1.1rem; }

        /* 3D Buttons Style - ŸáÿßÿØŸà ŸáŸàŸÖÿß ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÑŸä ÿ∑ŸÑÿ®ÿ™ŸáŸÖ */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 20px; }
        .btn-3d { 
            background: var(--card); color: white; padding: 20px 10px; border-radius: 20px; 
            border: none; border-bottom: 6px solid #000; font-size: 0.9rem; font-weight: bold; 
            cursor: pointer; transition: 0.1s; display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .btn-3d:active { transform: translateY(4px); border-bottom: 2px solid #000; }
        .btn-withdraw { grid-column: span 2; background: #222; border-bottom: 6px solid #111; color: var(--y); }

        /* Views */
        .view { height: 65vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .hidden { display: none !important; }

        /* Wheel Area */
        .wheel-container { position: relative; width: 280px; height: 280px; margin: 0 auto; border: 10px solid var(--y); border-radius: 50%; box-shadow: 0 0 30px rgba(255, 204, 0, 0.3); }
        .pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 35px; height: 35px; background: white; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10; }
        
        /* Task Button */
        .btn-task-main { 
            background: var(--y); color: var(--g); border: none; border-radius: 15px; 
            padding: 20px; width: 85%; font-size: 1.6rem; font-weight: 900; 
            border-bottom: 8px solid #b38f00; cursor: pointer;
        }
        .btn-task-main:active { transform: translateY(4px); border-bottom: 2px solid #b38f00; }

        .timer-emoji { font-size: 5rem; margin: 15px; display: inline-block; transition: 1s linear; }
    </style>
</head>
<body>

    <div style="display: flex; justify-content: space-between; padding: 15px;">
        <button onclick="goHome()" style="background:rgba(255,255,255,0.1); border:none; color:white; border-radius:10px; padding:8px 20px; font-weight:bold;">‚óÄ BACK</button>
        <button onclick="window.close()" style="background:rgba(255,0,0,0.2); border:none; color:white; border-radius:10px; padding:8px 20px; font-weight:bold;">EXIT ‚úñ</button>
    </div>

    <div class="balance-header">
        <div class="exm-part">EXM: <span id="e-val">0</span></div>
        <div class="usdt-part">USDT: <span id="u-val">0.0000</span></div>
    </div>

    <div id="h-view" class="menu-grid">
        <div class="btn-3d" onclick="v('s-view')"><span style="font-size:2rem">üé°</span>SPIN & WIN</div>
        <div class="btn-3d" onclick="v('e-view')"><span style="font-size:2rem">üí∞</span>EARN TASKS</div>
        <div class="btn-3d" onclick="v('l-view')"><span style="font-size:2rem">üèÜ</span>LUCKY DRAW</div>
        <div class="btn-3d" onclick="v('a-view')"><span style="font-size:2rem">ü§ù</span>AFFILIATE</div>
        <div class="btn-3d btn-withdraw" onclick="v('w-view')"><span style="font-size:1.5rem">üè¶</span>WITHDRAW & ADMIN</div>
    </div>

    <div id="s-view" class="view hidden">
        <div class="wheel-container"><div class="pointer"></div><canvas id="canvas" width="280" height="280"></canvas></div>
        <button class="btn-task-main" style="color:black; margin-top:30px;" onclick="spin()">SPIN FOR AD</button>
    </div>

    <div id="e-view" class="view hidden">
        <p style="padding:0 25px; font-weight:bold; color: var(--y);">Stay 1 min on ad page! Don't cheat! ‚ö†Ô∏è</p>
        <div class="timer-emoji" id="icon">‚è≤Ô∏è</div>
        <h1 id="sec" style="font-size:3rem; margin:0;">60s</h1>
        <button id="t-btn" class="btn-task-main" onclick="task()">Give me a task</button>
    </div>

    <div id="w-view" class="view hidden">
        <div style="background:var(--card); padding:30px; border-radius:25px; width:80%;">
            <input type="text" id="w-in" placeholder="Enter Wallet or Admin Code" style="width:100%; padding:15px; border-radius:10px; border:none; margin-bottom:20px; font-size:1rem;">
            <button class="btn-task-main" style="color:black; width:100%;" onclick="adminCheck()">SUBMIT</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { 
            apiKey: "AIzaSyD3xCKkyQT-6FOURJBjBaTNKOFItL2M87Q", 
            authDomain: "earnexmapp-8a0a2.firebaseapp.com", 
            projectId: "earnexmapp-8a0a2", 
            databaseURL: "https://earnexmapp-8a0a2-default-rtdb.firebaseio.com", 
            appId: "1:325148626791:web:0448e65046bb38e365e9c2" 
        };

        const app = initializeApp(conf); const db = getDatabase(app);
        const uid = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "Player_InisTa";
        const uRef = ref(db, 'users/' + uid);

        const prizes = ["50 EXM", "0.01$", "Lose", "2$", "5$", "1000 EXM", "1 Spin", "75 EXM", "0.2$", "Lose"];
        const ads = ["https://otieu.com/4/10493012", "https://www.effectivegatecpm.com/njze4eg1xg?key=159eb9bfcd4ae292e143bc346e6aa518"];

        window.v = (id) => { document.querySelectorAll('.view, #h-view').forEach(x => x.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); };
        window.goHome = () => { document.querySelectorAll('.view').forEach(x => x.classList.add('hidden')); document.getElementById('h-view').classList.remove('hidden'); };

        const can = document.getElementById('canvas'); const ctx = can.getContext('2d');
        function draw() { const a = (Math.PI*2)/prizes.length; prizes.forEach((txt, i) => { ctx.fillStyle = i%2==0 ? "#ff4d94" : "#ffcc00"; ctx.beginPath(); ctx.arc(140,140,135, i*a, (i+1)*a); ctx.lineTo(140,140); ctx.fill(); ctx.save(); ctx.fillStyle="black"; ctx.font="bold 12px Arial"; ctx.translate(140,140); ctx.rotate(i*a+a/2); ctx.fillText(txt, 65, 5); ctx.restore(); }); }
        draw();

        window.task = () => {
            const b = document.getElementById('t-btn');
            if(b.innerText === "Give me a task") { b.innerText = "Take it"; b.onclick = () => { window.open(ads[Math.floor(Math.random()*ads.length)], "_blank"); let s = 60; let t = setInterval(() => { s--; document.getElementById('sec').innerText = s+"s"; document.getElementById('icon').style.transform = `rotate(${360 - s*6}deg)`; if(s<=0) { clearInterval(t); alert("Success! 50 EXM Added."); get(uRef).then(snap => { let cur = snap.val()?.exm || 0; update(uRef, {exm: cur + 50}); goHome(); }); } }, 1000); }; }
        };

        window.adminCheck = () => { if(document.getElementById('w-in').value === "InisTa") alert("Welcome Admin InisTa! Everything is Ready."); else alert("Withdrawal request sent!"); };
        onValue(uRef, (s) => { const d = s.val() || {exm: 0}; document.getElementById('e-val').innerText = d.exm; document.getElementById('u-val').innerText = (d.exm * 0.00005).toFixed(4); });
    </script>
</body>
</html>
