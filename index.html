<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarnEXM Pro - Official</title>
    <style>
        :root { --y: #ffcc00; --g: #21a03e; --p: #ff4d94; --bg: #000b21; }
        body { margin: 0; background: radial-gradient(circle at center, #002d7a 0%, #000b21 100%); color: white; font-family: 'Arial Black', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Balance Bar - Black text on Yellow/Green */
        .balance-header { display: flex; width: 95%; margin: 10px auto; border-radius: 12px; overflow: hidden; height: 50px; font-weight: 900; border: 2px solid rgba(255,255,255,0.1); }
        .exm-box { background: var(--y); color: black; flex: 1; line-height: 50px; font-size: 1.1rem; }
        .usdt-box { background: var(--g); color: black; flex: 1; line-height: 50px; font-size: 1.1rem; }

        /* Views Control */
        .view { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .hidden { display: none !important; }

        /* Wheel Styles */
        .wheel-container { position: relative; width: 300px; height: 300px; }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; background: white; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10; border: 2px solid #000; }
        canvas { border: 10px solid var(--y); border-radius: 50%; transition: transform 4s cubic-bezier(0.1, 0, 0, 1); }

        /* Task & Spin Buttons */
        .btn-main { background: linear-gradient(to bottom, #ffdb00, #ffb000); color: #004d00; border: none; border-radius: 15px; width: 85%; padding: 20px; font-size: 1.5rem; font-weight: 900; border-bottom: 8px solid #b37a00; cursor: pointer; margin-top: 20px; }
        .btn-main:active { transform: translateY(4px); border-bottom: 2px solid #b37a00; }

        /* Bottom Nav - 100% Gamee Style */
        .nav-bar { display: grid; grid-template-columns: repeat(5, 1fr); background: #0a1020; border-top: 1px solid #333; height: 70px; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.6rem; font-weight: bold; color: #888; cursor: pointer; }
        .nav-item.active { color: var(--y); }
        .nav-item span { font-size: 1.5rem; margin-bottom: 2px; }

        .timer-emoji { font-size: 5rem; margin: 15px; }
    </style>
</head>
<body>

    <div class="balance-header">
        <div class="exm-box">EXM: <span id="e-val">0</span></div>
        <div class="usdt-box">USDT: <span id="u-val">0.0000</span></div>
    </div>

    <div id="v-spin" class="view">
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="canvas" width="300" height="300"></canvas>
        </div>
        <button id="spin-btn" class="btn-main" onclick="startSpin()">SPIN</button>
    </div>

    <div id="v-earn" class="view hidden">
        <p style="font-weight:bold; color:var(--y); text-align:center;">Stay 1 min on advertiser page! Don't cheat! ‚ö†Ô∏è</p>
        <div class="timer-emoji" id="t-icon">‚è≤Ô∏è</div>
        <h1 id="t-sec" style="font-size:3.5rem; margin:0;">60s</h1>
        <button id="t-btn" class="btn-main" onclick="handleTask()">Give me a task</button>
    </div>

    <div id="v-wallet" class="view hidden">
        <div style="background:#151e36; width:90%; padding:30px; border-radius:20px; border:1px solid #333;">
            <p style="color:#888;">Total Balance</p>
            <h1 id="w-usdt" style="font-size:2.5rem; margin:10px 0;">$0.0000</h1>
            <input type="text" id="w-addr" placeholder="Wallet Address" style="width:100%; padding:15px; border-radius:10px; border:none; background:#000; color:white;">
            <button class="btn-main" style="width:100%; font-size:1.1rem;" onclick="checkAdmin()">WITHDRAW</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item" onclick="show('v-spin')"><span>üé°</span>Spin</div>
        <div class="nav-item" onclick="show('v-earn')"><span>üöÄ</span>Earn</div>
        <div class="nav-item" onclick="alert('Lucky Draw: Friday')"><span>üèÜ</span>Lucky</div>
        <div class="nav-item" onclick="alert('Affiliate: Coming')"><span>ü§ù</span>Invite</div>
        <div class="nav-item" onclick="show('v-wallet')"><span>üè¶</span>Wallet</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { apiKey: "AIzaSyD3xCKkyQT-6FOURJBjBaTNKOFItL2M87Q", authDomain: "earnexmapp-8a0a2.firebaseapp.com", projectId: "earnexmapp-8a0a2", databaseURL: "https://earnexmapp-8a0a2-default-rtdb.firebaseio.com", appId: "1:325148626791:web:0448e65046bb38e365e9c2" };
        const app = initializeApp(conf); const db = getDatabase(app);
        const uid = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "Dev_InisTa";
        const uRef = ref(db, 'users/' + uid);

        const prizes = ["50 EXM", "0.01$", "Lose", "2$", "5$", "1000 EXM", "1 Spin", "75 EXM", "0.2$", "100 EXM"];
        const ads = ["https://otieu.com/4/10493012", "https://www.effectivegatecpm.com/njze4eg1xg?key=159eb9bfcd4ae292e143bc346e6aa518"];
        let spinCount = 0;

        window.show = (id) => { document.querySelectorAll('.view').forEach(v => v.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); };

        // Wheel Logic
        const can = document.getElementById('canvas'); const ctx = can.getContext('2d');
        function draw() {
            const a = (Math.PI*2)/prizes.length;
            prizes.forEach((t, i) => {
                ctx.fillStyle = i%2==0 ? "#ff4d94" : "#ffcc00";
                ctx.beginPath(); ctx.arc(150,150,145, i*a, (i+1)*a); ctx.lineTo(150,150); ctx.fill();
                ctx.save(); ctx.fillStyle="black"; ctx.font="bold 12px Arial"; ctx.translate(150,150); ctx.rotate(i*a+a/2); ctx.fillText(t, 75, 5); ctx.restore();
            });
        }
        draw();

        window.startSpin = () => {
            if(spinCount >= 2) { 
                if(confirm("Watch an ad to spin again?")) { window.open(ads[0], "_blank"); spinCount = 0; }
                return;
            }
            const deg = Math.floor(5000 + Math.random() * 5000);
            can.style.transform = `rotate(${deg}deg)`;
            spinCount++;
            setTimeout(() => { alert("You won! Reward added."); update(uRef, {exm: (parseInt(document.getElementById('e-val').innerText) + 50)}); }, 4000);
        };

        window.handleTask = () => {
            const b = document.getElementById('t-btn');
            if(b.innerText === "Give me a task") {
                b.innerText = "Take it";
                b.onclick = () => {
                    window.open(ads[Math.floor(Math.random()*ads.length)], "_blank");
                    let s = 60; let t = setInterval(() => {
                        s--; document.getElementById('t-sec').innerText = s+"s";
                        document.getElementById('t-icon').style.transform = `rotate(${360 - s*6}deg)`;
                        if(s<=0) { clearInterval(t); alert("Reward Ready!"); b.innerText = "Claim 50 EXM"; b.onclick = () => { update(uRef, {exm: (parseInt(document.getElementById('e-val').innerText) + 50)}); show('v-spin'); }; }
                    }, 1000);
                };
            }
        };

        window.checkAdmin = () => { if(document.getElementById('w-addr').value === "InisTa") alert("Admin: 125M Players"); else alert("Pending..."); };

        onValue(uRef, (s) => {
            const d = s.val() || {exm: 0};
            document.getElementById('e-val').innerText = d.exm;
            document.getElementById('u-val').innerText = (d.exm * 0.00005).toFixed(4);
            document.getElementById('w-usdt').innerText = "$" + (d.exm * 0.00005).toFixed(4);
        });
    </script>
</body>
</html>

